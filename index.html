<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>getstream.io Chat API Test</title>
</head>
<body>
  <script src="streamchat.browser.full-bundle.min.js"></script>
  <script type="module">
    async function runLoopForUser(uid) {
      let resp = await fetch(`http://localhost:8000/users/${uid}/token`);
      const token = await resp.text();

      const client = StreamChat.getInstance('gnyz9ddzsq6u');

      await client.connectUser(
        {
          id: uid,
          name: uid
        },
        token
      );

      const channel = client.channel('messaging', 'talk', {
        name: 'Test channel',
      });

      await channel.watch();

      await channel.on('message.new', e => {
        console.log(`${uid} got message:`, e.message.text);
      });

      for (i = 0; i < 10; i++) {
        // Sleep for a while.
        new Promise(resolve => setTimeout(resolve, 1000));

        await channel.sendMessage({
          text: `message ${i} from ${uid}`
        });
      }


    runLoopForUser("u1");
  </script>
</body>
</html>
